# ---- Core Settings ----

# Enable mouse support (you can click to select windows/panes)
set -g mouse on

# Set prefix key to Ctrl+a instead of the default Ctrl-b
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable 256-color mode and TrueColor
set -g default-terminal "tmux-256color"

# Shorter command delay for faster keybinding response
set -sg escape-time 10

# Split panes using | and -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Reload tmux configuration file with Ctrl-a + r
bind r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Status bar settings
set -g status-interval 60
set -g status-right "#(whoami)@#H %H:%M"

# Enable vi mode in copy mode
setw -g mode-keys vi

# Pane navigation using Alt + arrow keys
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# ---- Tmux Plugin Manager (TPM) and Plugins ----
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'janoamaral/tokyo-night-tmux'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'junegunn/fzf'

# Initialize TPM (Keep this at the bottom)
run '~/.tmux/plugins/tpm/tpm'

# ---- Tokyo Night Theme Customization ----
set -g @tokyo-night-tmux_window_id_style digital
set -g @tokyo-night-tmux_pane_id_style hsquare
set -g @tokyo-night-tmux_zoom_id_style dsquare
set -g @tokyo-night-tmux_show_datetime 1   # Enable date/time widget
set -g @tokyo-night-tmux_show_music 1      # Enable now playing widget
set -g @tokyo-night-tmux_show_netspeed 1   # Enable network speed widget

# ---- Tmux Resurrect Configuration ----
bind r source-file ~/.tmux.conf \; run-shell ~/.tmux/plugins/tmux-resurrect/scripts/restore.sh
bind s run-shell ~/.tmux/plugins/tmux-resurrect/scripts/save.sh

# Save and restore sessions with Ctrl-s and Ctrl-r
bind C-s run-shell "~/scripts/save_state.sh"
bind C-r run-shell "~/scripts/restore_state.sh"

# ---- Tmux Sessionist Configuration (Sessionizer) ----
bind S choose-session     # List available sessions with Ctrl-a + S (uppercase S)
bind A command-prompt -p "Attach to session: " "switch-client -t '%%'"  # Attach to session by name with Ctrl-a + A
bind R command-prompt "rename-session"  # Rename the current session with Ctrl-a + R
bind C-n new-session -s "#{pane_current_path##*/}" \; send-keys "cd #{pane_current_path}" C-m  # New session with Ctrl-n

# ---- tmux-yank ----
# Yank to system clipboard from tmux copy mode with 'y' or 'Y'
# No extra configuration needed.

# ---- fzf-tmux ----
# Fuzzy find through panes with Ctrl-p
bind C-p run-shell "~/scripts/fzf_search.sh"

# ---- Git Shortcuts ----
# Git status with Ctrl-g
bind C-g run-shell "~/scripts/git_shortcuts.sh status"
# Git pull with Ctrl-u
bind C-u run-shell "~/scripts/git_shortcuts.sh pull"
# Git push with Ctrl-p
bind C-p run-shell "~/scripts/git_shortcuts.sh push"

# ---- Custom Keybindings ----
# Bind Ctrl-n to create a new session named after the current directory
bind C-n new-session -s "#{pane_current_path##*/}" \; send-keys "cd #{pane_current_path}" C-m

# Automatically rename windows based on their active command
setw -g automatic-rename on

# Display Git branch in status-right (Optional, requires script to fetch Git branch)
set -g status-right "#(~/scripts/git_branch.sh) | %H:%M"

# Pane and window management shortcuts
bind W command-prompt "rename-window %%"
set -g window-status-current-style fg=yellow,bg=black,bold
set -g pane-border-style fg=brightblack
set -g pane-active-border-style fg=brightyellow
